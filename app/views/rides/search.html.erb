<% provide(:title, 'Find a ride') %>
<% content_for(:body_settings) do %>
  onload="initialize()"
<% end %>
<h1>Find a Ride</h1>
<h2>995,222 rides available in your region</h2>
<div class="row-fluid">
      <div class="span6">
        <%= form_for(@ride, :url => show_search_results_path) do |f| %>      
          <%= render 'rides/error_messages' %>

          <%= f.label :start_address %>
          <%= f.text_field :start_address, :onchange => "calcRoute()" %>

          <%= f.label :end_address %>
          <%= f.text_field :end_address, :onchange => "calcRoute()"%>

          <%= f.label :start_date, "Date DD-MM-YYYY" %>
          <%= f.text_field :start_date, :value => "13-09-2012" %>

          <%= f.label :start_time, "Time HH:MM" %>
          <%= f.text_field :start_time, :value => "13:00"  %>

          <%= submit_tag "by start time", { :type => 'button', :class => 'btn btn-success disabled', :id => 'start_time_btn' } %>
          <%= submit_tag "by arrival time", { :type => 'button', :class => 'btn btn-success', :id => 'arrival_time_btn' } %>

          <%= label_tag "Tolerance in Minutes" %>
          <%= text_field_tag :tolerance, "10" %>

          <%= hidden_field_tag :search_by, "start" %>
          <%= f.hidden_field :user_id, :value => current_user.id %>
          <%= f.hidden_field :start_lat %>
          <%= f.hidden_field :start_long %>
          <%= f.hidden_field :end_lat %>
          <%= f.hidden_field :end_long %>
          <%= hidden_field_tag :duration %>
          <%= f.hidden_field :end_time %>
          <%= f.hidden_field :end_date %>

          <%= f.submit "Show available rides", class: "btn btn-large btn-primary" %>
        <% end %>

      </div>      
      <div class="span6">
        <%= render 'map' %>
        <div id="map_details">
          <span id="map_details_distance"></span><br />
          <span id="map_details_duration"></span>
        </div>
      </div>
</div>
<% if @out_rides && @out_rides.any? %>
  <div class="row">
    <div class="span12">
      <table class="table table-condensed">
        <thead>
          <tr>
              <td>
                Start Date
              </td>          
              <td>
                Start Time
              </td> 
              <td>
                Start Address
              </td>
              <td>
                End Address
              </td>
              <td>
                Price per Seat
              </td>
              <td>
                Seats available
              </td>
              <td>
                
              </td>
              <td>
                
              </td>
          </tr>
        </thead>
        <tbody>
          <% @out_rides.each do |r| %>
            <tr>
              <td>
                <%= r.start_time.strftime("%d-%m-%Y") %>
              </td>
              <td>
                <%= r.start_time.strftime("%H:%M") %>
              </td>
              <td>
                <%= r.start_address %>
              </td>
              <td>
                <%= r.end_address %>
              </td>
              <td>
                <%= get_price r %>
              </td>
              <td>
                <%= get_available_seats_count r %>
              </td>
              <td>
                <%= link_to "show", show_ride_path(:id => r) %>
              </td>
              <td>
                <%= link_to "request", ride_requests_path(:ride => r,
                                                          :start_address => r.start_address,
                                                          :end_address => r.end_address,
                                                          :start_date => r.start_date,
                                                          :start_time => r.start_time,
                                                          :end_date => r.end_date,
                                                          :end_time => r.end_time), method: :post %>
              </td>
            </tr>
          <% end %>
        </tbody>   
      </table>
    </div>
  </div>
<% end %>
<script type="text/javascript">
  $(document).ready(function() {
    $('#start_time_btn').click(function() {
      document.getElementById("search_by").value = "start";
      document.getElementById("start_time_btn").className = 'btn btn-success disabled'
      document.getElementById("arrival_time_btn").className = 'btn btn-success'
    });
    $('#arrival_time_btn').click(function() {
      document.getElementById("search_by").value = "arrival";
      document.getElementById("start_time_btn").className = 'btn btn-success'
      document.getElementById("arrival_time_btn").className = 'btn btn-success disabled'
    });
  });
</script>
